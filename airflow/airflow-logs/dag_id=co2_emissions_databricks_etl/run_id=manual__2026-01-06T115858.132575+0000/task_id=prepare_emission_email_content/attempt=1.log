[2026-01-06T12:02:52.262+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: co2_emissions_databricks_etl.prepare_emission_email_content manual__2026-01-06T11:58:58.132575+00:00 [queued]>
[2026-01-06T12:02:52.276+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: co2_emissions_databricks_etl.prepare_emission_email_content manual__2026-01-06T11:58:58.132575+00:00 [queued]>
[2026-01-06T12:02:52.278+0000] {taskinstance.py:2170} INFO - Starting attempt 1 of 3
[2026-01-06T12:02:52.295+0000] {taskinstance.py:2191} INFO - Executing <Task(PythonOperator): prepare_emission_email_content> on 2026-01-06 11:58:58.132575+00:00
[2026-01-06T12:02:52.302+0000] {standard_task_runner.py:60} INFO - Started process 4009 to run task
[2026-01-06T12:02:52.307+0000] {standard_task_runner.py:87} INFO - Running: ['***', 'tasks', 'run', 'co2_emissions_databricks_etl', 'prepare_emission_email_content', 'manual__2026-01-06T11:58:58.132575+00:00', '--job-id', '37', '--raw', '--subdir', 'DAGS_FOLDER/co2_emissions.py', '--cfg-path', '/tmp/tmp_4r7_3ve']
[2026-01-06T12:02:52.310+0000] {standard_task_runner.py:88} INFO - Job 37: Subtask prepare_emission_email_content
[2026-01-06T12:02:52.384+0000] {task_command.py:423} INFO - Running <TaskInstance: co2_emissions_databricks_etl.prepare_emission_email_content manual__2026-01-06T11:58:58.132575+00:00 [running]> on host f2fb2b408209
[2026-01-06T12:02:52.489+0000] {taskinstance.py:2480} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='Nikhitha' AIRFLOW_CTX_DAG_ID='co2_emissions_databricks_etl' AIRFLOW_CTX_TASK_ID='prepare_emission_email_content' AIRFLOW_CTX_EXECUTION_DATE='2026-01-06T11:58:58.132575+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2026-01-06T11:58:58.132575+00:00'
[2026-01-06T12:02:52.525+0000] {base.py:83} INFO - Using connection ID 'databricks_default' for task execution.
[2026-01-06T12:02:54.378+0000] {client.py:200} INFO - Successfully opened session 01f0eaf7-a131-1a1d-a4f1-48a075107a13
[2026-01-06T12:02:54.379+0000] {sql.py:450} INFO - Running statement: SELECT
            country,
            region,
            year,
            total_co2_emissions_mt,
            threshold_value,
            alert_status
        FROM co2_emissions.default.gold_emission_alerts
        WHERE alert_status = 'ALERT'
        ORDER BY total_co2_emissions_mt DESC, parameters: None
[2026-01-06T12:02:55.904+0000] {client.py:258} INFO - Closing session 01f0eaf7-a131-1a1d-a4f1-48a075107a13
[2026-01-06T12:02:56.289+0000] {python.py:201} INFO - Done. Returned value was: 
    <h3>ðŸš¨ COâ‚‚ Emission Spike Alert</h3>

    <p>
        <b>Total Countries Triggered:</b> 17 <br/>
        <b>Threshold Logic:</b> 95th Percentile (Global)
    </p>

    <table border="1" cellpadding="6" cellspacing="0"
           style="border-collapse:collapse;">
        <tr style="background-color:#f2f2f2;">
            <th>Country</th>
            <th>Region</th>
            <th>Year</th>
            <th>Total COâ‚‚ Emissions (MT)</th>
            <th>Threshold</th>
            <th>Status</th>
        </tr>
        
        <tr>
            <td>United States</td>
            <td>North America</td>
            <td>2019</td>
            <td>1953376.9799999997</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>France</td>
            <td>Europe</td>
            <td>2017</td>
            <td>1944654.6000000003</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>Canada</td>
            <td>North America</td>
            <td>2007</td>
            <td>1931124.0299999998</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>France</td>
            <td>Europe</td>
            <td>1991</td>
            <td>1930348.8299999996</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>Canada</td>
            <td>North America</td>
            <td>2004</td>
            <td>1914817.8600000013</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>Japan</td>
            <td>Asia</td>
            <td>2004</td>
            <td>1897939.5000000005</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>United States</td>
            <td>North America</td>
            <td>2008</td>
            <td>1893920.3599999994</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>China</td>
            <td>Asia</td>
            <td>2006</td>
            <td>1892163.4500000002</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>United States</td>
            <td>North America</td>
            <td>2002</td>
            <td>1890195.5699999984</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>Japan</td>
            <td>Asia</td>
            <td>2014</td>
            <td>1889032.4000000004</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>Germany</td>
            <td>Europe</td>
            <td>2004</td>
            <td>1876512.1200000003</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>Germany</td>
            <td>Europe</td>
            <td>1990</td>
            <td>1860507.4999999995</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>United States</td>
            <td>North America</td>
            <td>2012</td>
            <td>1847094.4799999988</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>China</td>
            <td>Asia</td>
            <td>1992</td>
            <td>1837348.9800000004</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>Japan</td>
            <td>Asia</td>
            <td>1990</td>
            <td>1824809.1800000006</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>Brazil</td>
            <td>South America</td>
            <td>2015</td>
            <td>1824102.6499999992</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
        <tr>
            <td>United Kingdom</td>
            <td>Europe</td>
            <td>2001</td>
            <td>1823923.8599999999</td>
            <td>1823923.8599999999</td>
            <td style="color:red; font-weight:bold;">ALERT</td>
        </tr>
        
    </table>

    <br/>
    <h4>ðŸ“Š Power BI â€“ Active Emission Alerts</h4>
    <p>
    Below is a snapshot of the Power BI dashboard showing
    active COâ‚‚ emission alerts and trends.
    </p>

    <img src="cid:powerbi_alerts" width="700"/>

    <hr/>
    <p style="font-size:12px;color:gray;">
    Generated by Airflow Â· Databricks GOLD layer Â· 2026-01-06 12:02 UTC
    </p>
    
[2026-01-06T12:02:56.331+0000] {taskinstance.py:1138} INFO - Marking task as SUCCESS. dag_id=co2_emissions_databricks_etl, task_id=prepare_emission_email_content, execution_date=20260106T115858, start_date=20260106T120252, end_date=20260106T120256
[2026-01-06T12:02:56.333+0000] {co2_emissions.py:136} INFO - âœ… Pipeline completed in 4.067683s
[2026-01-06T12:02:56.405+0000] {local_task_job_runner.py:234} INFO - Task exited with return code 0
[2026-01-06T12:02:56.428+0000] {taskinstance.py:3280} INFO - 1 downstream tasks scheduled from follow-on schedule check
